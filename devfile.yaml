schemaVersion: 2.1.0
metadata:
  name: sams-dev
projects:
  -  name: sams-cola
     git:
       remotes: 
         origin: 'git@github.com:la-county-isd/sams-cola.git'
       checkoutFrom:
         revision: main
components:
  - name: tools
    container:
      #image: registry.redhat.io/devspaces/udi-rhel8:3.9
      image: quay.io/kayvon77/ruby-dev:1.0
      memoryLimit: '2Gi'
      memoryRequest: '1Gi'
      cpuLimit: '1'
      cpuRequest: '0.5'
      mountSources: true
      endpoints:
        - exposure: public
          name: 'sams-endpoint'
          targetPort: 3000
      env:
        - name: RAILS_ENV
          value: development
        - name: PROJECTROOT
          value: ${PROJECT_ROOT}
        - name: DATABASE_URL
          value: mysql2://root:example@db:3306
        - name: MEMCACHED_HOST
          value: memcached
        - name: ELASTICSEARCH_URL
          value: http://es:9200
        - name: REDIS_URL
          value: redis://redis:6379
        - name: MAILDEV_HOST
          value: maildev
        - name: MINIO_ACCESS_KEY
          value: minio_development
        - name: MINIO_SECRET_KEY
          value: minio_development
        - name: MINIO_BUCKET
          value: secure-bucket
  # - name: db
  #   container:
  #     args:
  #       - --default-authentication-plugin=mysql_native_password 
  #     image: mysql:8.0
  #     memoryLimit: '2Gi'
  #     memoryRequest: '1Gi'
  #     cpuLimit: '1'
  #     cpuRequest: '0.5'
  #     mountSources: false
  #     dedicatedPod: true
  #     env:
  #       - name: MYSQL_ROOT_PASSWORD
  #         value: example
  #       - name: MYSQL_DATABASE
  #         value: sams_development
  #       - name: MYSQL_USER
  #         value: sams
  #       - name: MYSQL_PASSWORD
  #         value: samspassword
  #     endpoints:
  #       - name: db
  #         targetPort: 3306
  #         protocol: tcp
  #         exposure: internal
  - name: db
    openshift:
      endpoints:
        - exposure: internal
          name: db
          targetPort: 3306
          protocol: tcp
      uri: db.yaml
commands:
  - id: build
    exec:
      commandLine: ${PROJECT_SOURCE}/bin/bundle install --path vendor/bundle && npm i
      component: tools
      group:
        kind: build
        isDefault: true

  #    volumeMounts:
  #      - name: nuget
  #        path: /home/user/.nuget
 # - name: nuget
 #   volume:
 #     size: 1G

    
       
 
